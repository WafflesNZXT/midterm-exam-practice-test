<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra 2 Mid-Term Practice Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .graph-option-card {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .graph-option-card:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .graph-option-card.selected {
            border-color: #2563eb;
            background-color: #dbeafe;
            ring: 2px solid #2563eb;
        }
        .axis {
            stroke: #475569;
            stroke-width: 1.5;
        }
        .grid-line {
            stroke: #e2e8f0;
            stroke-width: 0.5;
        }
        .graph-curve {
            stroke: #2563eb;
            stroke-width: 2.5;
            fill: none;
            stroke-linecap: round;
        }
        canvas#scratch-pad {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 40;
        }
        
        .drawing-active canvas#scratch-pad {
            pointer-events: auto;
            cursor: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTE3IDNsNCA0TDEwIDIwSDR2LTZMMTcgM3oiLz48cGF0aCBkPSJNMTUgNmw0IDQiLz48L3N2Zz4=") 0 24, auto;
        }

        .tool-btn.active {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            outline: 2px solid #2563eb;
        }
        .color-swatch.active {
            ring: 2px offset 2px ring-slate-400;
            transform: scale(1.1);
        }
        
        body.exam-locked:not(.exam-submitted) main, 
        body.exam-locked:not(.exam-submitted) footer {
            filter: blur(8px);
            pointer-events: none;
            user-select: none;
        }

        #results-overlay {
            z-index: 200;
        }
        
        .correct-choice {
            border-color: #10b981 !important;
            background-color: #ecfdf5 !important;
        }
        .incorrect-choice {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans pb-32 exam-locked">

    <div id="exam-gatekeeper" class="fixed inset-0 bg-slate-900/80 flex items-center justify-center p-6 text-center z-[100]">
        <div class="bg-white p-8 rounded-2xl max-w-md shadow-2xl border-t-8 border-blue-600">
            <h2 class="text-3xl font-black text-slate-800 mb-4">Algebra 2 Mid-Term</h2>
            <p class="text-slate-600 mb-8 leading-relaxed">60 Multiple Choice Questions. 60 Minutes. Use the tools for scratch work. Good luck!</p>
            <button onclick="startExam()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl text-xl shadow-lg transition-transform active:scale-95">
                Begin Exam
            </button>
        </div>
    </div>

    <div id="results-overlay" class="fixed inset-0 bg-slate-900/95 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div id="results-content" class="w-full max-w-2xl my-auto"></div>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-slate-900/60 hidden z-[150] flex items-center justify-center p-4">
        <div id="modal-content" class="bg-white rounded-2xl max-w-lg w-full p-8 shadow-2xl"></div>
    </div>

    <canvas id="scratch-pad"></canvas>

    <header class="sticky top-0 bg-white/90 border-b shadow-sm z-50 px-4 py-3 backdrop-blur-md">
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div>
                    <h1 class="text-xl font-bold text-slate-800">Algebra 2 Practice</h1>
                    <p id="timer-display" class="text-lg font-mono font-bold text-red-600">60:00</p>
                </div>
                <button id="pause-btn" onclick="togglePause()" class="hidden bg-slate-100 p-2 rounded-lg border">‚è∏Ô∏è</button>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="flex items-center bg-slate-100 rounded-lg p-1 gap-1 border">
                    <button onclick="setTool('cursor')" id="btn-cursor" class="tool-btn active p-1.5 rounded">üñ±Ô∏è</button>
                    <button onclick="setTool('pen')" id="btn-pen" class="tool-btn p-1.5 rounded">üñãÔ∏è</button>
                    <button onclick="setTool('marker')" id="btn-marker" class="tool-btn p-1.5 rounded">üñçÔ∏è</button>
                    <div class="w-px h-6 bg-slate-300 mx-1"></div>
                    <button onclick="setColor('#2563eb')" class="color-swatch active w-5 h-5 rounded-full bg-blue-600" id="color-blue"></button>
                    <button onclick="setColor('#ef4444')" class="color-swatch w-5 h-5 rounded-full bg-red-500" id="color-red"></button>
                    <button onclick="setColor('#000000')" class="color-swatch w-5 h-5 rounded-full bg-black" id="color-black"></button>
                    <div class="w-px h-6 bg-slate-300 mx-1"></div>
                    <button onclick="clearScratchpad()" class="px-2 text-[10px] font-bold text-slate-500 hover:text-red-500">Clear</button>
                </div>
                <div class="flex items-center gap-4 border-l pl-4">
                    <p id="progress-text" class="text-lg font-bold text-blue-600">0/60</p>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-4 space-y-12" id="test-container"></main>

    <footer class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 z-50 shadow-2xl">
        <div class="max-w-5xl mx-auto flex justify-between items-center">
            <p class="text-slate-500 text-xs">Verify all answers before submitting.</p>
            <button onclick="confirmSubmit()" id="submit-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-xl shadow-lg transition-all active:scale-95">
                Submit Exam
            </button>
        </div>
    </footer>

    <script>
        function generateGraphSVG(type, params) {
            const size = 100;
            const center = 50;
            const unit = 8;
            let path = "";

            const toPx = (x) => center + (x * unit);
            const toPy = (y) => center - (y * unit);

            if (type === 'line') {
                const { m, b } = params;
                const x1 = -6, y1 = m * x1 + b;
                const x2 = 6, y2 = m * x2 + b;
                path = `M ${toPx(x1)} ${toPy(y1)} L ${toPx(x2)} ${toPy(y2)}`;
            } else if (type === 'parabola') {
                const { h, k, a } = params;
                for (let x = -6; x <= 6; x += 0.1) {
                    const y = a * Math.pow(x - h, 2) + k;
                    if (y >= -10 && y <= 10) { 
                        path += (path === "" ? "M " : "L ") + `${toPx(x)} ${toPy(y)} `;
                    }
                }
            } else if (type === 'abs') {
                const { h, k, a } = params;
                const x1 = -6, y1 = a * Math.abs(x1 - h) + k;
                const x2 = h, y2 = k;
                const x3 = 6, y3 = a * Math.abs(x3 - h) + k;
                path = `M ${toPx(x1)} ${toPy(y1)} L ${toPx(x2)} ${toPy(y2)} L ${toPx(x3)} ${toPy(y3)}`;
            }

            return `
                <svg viewBox="0 0 100 100" class="w-full h-full bg-white border rounded shadow-inner">
                    ${[...Array(13).keys()].map(i => {
                        return `<line x1="${i*8.33}" y1="0" x2="${i*8.33}" y2="100" class="grid-line" />
                                <line x1="0" y1="${i*8.33}" x2="100" y2="${i*8.33}" class="grid-line" />`;
                    }).join('')}
                    <line x1="50" y1="0" x2="50" y2="100" class="axis" />
                    <line x1="0" y1="50" x2="100" y2="50" class="axis" />
                    <path d="${path}" class="graph-curve" />
                </svg>
            `;
        }

        const questions = [
            { id: 1, type: 'mcq', q: "Which of the following is an irrational number?", options: ["‚àö121", "0.333...", "‚àö20", "22/7"], correct: 2 },
            { id: 2, type: 'mcq', q: "Simplify: 3‚àö50 - 2‚àö8", options: ["‚àö42", "11‚àö2", "13‚àö2", "7‚àö2"], correct: 1 },
            { id: 3, type: 'mcq', q: "Solve for x: |2x - 5| = 13", options: ["{9}", "{9, -4}", "{-9, 4}", "No Solution"], correct: 1 },
            { id: 4, type: 'mcq', q: "What is the value of i¬≤‚Å∂?", options: ["i", "-i", "1", "-1"], correct: 3 },
            { id: 5, type: 'mcq', q: "Find the product: (3 - 2i)(4 + 5i)", options: ["12 - 10i", "22 + 7i", "2 + 7i", "22 - 7i"], correct: 1 },
            { id: 6, type: 'mcq', q: "Which property is illustrated by a(b + c) = ab + ac?", options: ["Commutative", "Associative", "Distributive", "Identity"], correct: 2 },
            { id: 7, type: 'mcq', q: "Simplify: (2x¬≥y¬≤)¬≥", options: ["6x‚Å∂y‚Åµ", "8x‚Å∂y‚Åµ", "8x‚Åπy‚Å∂", "6x‚Åπy‚Å∂"], correct: 2 },
            { id: 8, type: 'mcq', q: "Solve: 5x - 3 > 2x + 9", options: ["x > 4", "x < 4", "x > 2", "x < 2"], correct: 0 },
            { id: 9, type: 'mcq', q: "What is the conjugate of 7 + 3i?", options: ["-7 - 3i", "7 - 3i", "3 + 7i", "-7 + 3i"], correct: 1 },
            { id: 10, type: 'mcq', q: "Evaluate 27^(2/3)", options: ["3", "6", "9", "18"], correct: 2 },
            { id: 11, type: 'mcq', q: "Solve for x: 2(x - 4) + 3x = 7", options: ["3", "1", "15/5", "3"], correct: 0 },
            { id: 12, type: 'mcq', q: "Solve the system: x + y = 10, x - y = 4", options: ["(7, 3)", "(6, 4)", "(8, 2)", "(5, 5)"], correct: 0 },
            { id: 13, type: 'mcq', q: "Find the slope of a line perpendicular to y = -3x + 5", options: ["-3", "3", "1/3", "-1/3"], correct: 2 },
            { id: 14, type: 'mcq', q: "What is the vertex of y = |x + 5| - 2?", options: ["(5, -2)", "(-5, -2)", "(-5, 2)", "(5, 2)"], correct: 1 },
            { id: 15, type: 'mcq', q: "Find the discriminant of x¬≤ - 4x + 4 = 0", options: ["16", "0", "-16", "8"], correct: 1 },
            { id: 16, type: 'mcq', q: "Factor completely: x¬≤ - 49", options: ["(x-7)¬≤", "(x+7)¬≤", "(x-7)(x+7)", "(x-49)(x+1)"], correct: 2 },
            { id: 17, type: 'mcq', q: "Solve by factoring: x¬≤ - 5x + 6 = 0", options: ["{2, 3}", "{-2, -3}", "{1, 6}", "{-1, -6}"], correct: 0 },
            { id: 18, type: 'mcq', q: "What is the y-intercept of 3x - 4y = 12?", options: ["3", "-3", "4", "-4"], correct: 1 },
            { id: 19, type: 'mcq', q: "Simplify: (x + 3)(x - 5)", options: ["x¬≤ - 15", "x¬≤ + 2x - 15", "x¬≤ - 2x - 15", "x¬≤ - 8x - 15"], correct: 2 },
            { id: 20, type: 'mcq', q: "Solve for x: ‚àö(x + 2) = 5", options: ["3", "7", "23", "27"], correct: 2 },
            { id: 21, type: 'graph-mcq', q: "Which graph represents the linear function y = (2/3)x - 4?", graphs: [{ type: 'line', params: { m: 2/3, b: -4 } },{ type: 'line', params: { m: -2/3, b: -4 } },{ type: 'line', params: { m: 2/3, b: 4 } },{ type: 'line', params: { m: 1, b: 0 } }], correct: 0 },
            { id: 22, type: 'graph-mcq', q: "Select the graph of f(x) = (x + 3)¬≤ - 2.", graphs: [{ type: 'parabola', params: { h: 3, k: -2, a: 1 } },{ type: 'parabola', params: { h: -3, k: -2, a: 1 } },{ type: 'parabola', params: { h: -3, k: 2, a: 1 } },{ type: 'parabola', params: { h: 0, k: 0, a: 1 } }], correct: 1 },
            { id: 23, type: 'graph-mcq', q: "Identify the graph of y = |x - 2| + 1.", graphs: [{ type: 'abs', params: { h: 2, k: 1, a: 1 } },{ type: 'abs', params: { h: -2, k: 1, a: 1 } },{ type: 'abs', params: { h: 2, k: -1, a: 1 } },{ type: 'abs', params: { h: 0, k: 0, a: 1 } }], correct: 0 },
            { id: 24, type: 'graph-mcq', q: "Which graph shows y = -x¬≤ + 3?", graphs: [{ type: 'parabola', params: { h: 0, k: 3, a: -1 } },{ type: 'parabola', params: { h: 0, k: -3, a: 1 } },{ type: 'parabola', params: { h: 3, k: 0, a: 1 } },{ type: 'parabola', params: { h: -3, k: 0, a: -1 } }], correct: 0 },
            { id: 25, type: 'mcq', q: "The graph of y = f(x - 2) is a shift of f(x) in which direction?", options: ["Up 2", "Down 2", "Left 2", "Right 2"], correct: 3 },
            { id: 26, type: 'mcq', q: "Identify the axis of symmetry for y = (x - 4)¬≤ + 7", options: ["x = 7", "y = 7", "x = 4", "y = 4"], correct: 2 },
            { id: 27, type: 'mcq', q: "What is the domain of f(x) = ‚àöx?", options: ["All real numbers", "x > 0", "x ‚â• 0", "x < 0"], correct: 2 },
            { id: 28, type: 'mcq', q: "Find the midpoint of (2, 4) and (6, 10)", options: ["(4, 7)", "(8, 14)", "(2, 3)", "(4, 6)"], correct: 0 },
            { id: 29, type: 'mcq', q: "Find the distance between (0,0) and (3,4)", options: ["7", "1", "5", "25"], correct: 2 },
            { id: 30, type: 'mcq', q: "Which function is even?", options: ["y = x", "y = x¬≥", "y = x¬≤", "y = x + 1"], correct: 2 },
            { id: 31, type: 'mcq', q: "Factor: x¬≥ + 8", options: ["(x+2)¬≥", "(x+2)(x¬≤-2x+4)", "(x-2)(x¬≤+2x+4)", "(x+2)(x¬≤-4)"], correct: 1 },
            { id: 32, type: 'mcq', q: "Simplify: (x¬≤ + 5x + 6) / (x + 2)", options: ["x + 3", "x + 2", "x - 3", "x + 6"], correct: 0 },
            { id: 33, type: 'mcq', q: "What is the remainder of (x¬≤ - 5x + 8) √∑ (x - 2)?", options: ["1", "2", "3", "4"], correct: 1 },
            { id: 34, type: 'mcq', q: "Find the zeros of f(x) = x(x - 4)(x + 1)", options: ["{0, 4, -1}", "{4, -1}", "{0, -4, 1}", "No zeros"], correct: 0 },
            { id: 35, type: 'mcq', q: "Expand: (2x - 1)¬≤", options: ["4x¬≤ + 1", "4x¬≤ - 1", "4x¬≤ - 4x + 1", "4x¬≤ + 4x + 1"], correct: 2 },
            { id: 36, type: 'mcq', q: "Factor by grouping: x¬≥ + 2x¬≤ + 3x + 6", options: ["(x¬≤+3)(x+2)", "(x¬≤+2)(x+3)", "(x-2)(x¬≤+3)", "Not factorable"], correct: 0 },
            { id: 37, type: 'mcq', q: "What is the degree of 5x‚Å¥ - 2x¬≥ + x - 7?", options: ["5", "4", "3", "1"], correct: 1 },
            { id: 38, type: 'mcq', q: "Simplify: (4x¬≤ - 9) / (2x + 3)", options: ["2x + 3", "2x - 3", "x - 3", "4x - 3"], correct: 1 },
            { id: 39, type: 'mcq', q: "Solve: x¬≤ + 16 = 0", options: ["¬±4", "¬±4i", "4", "-4"], correct: 1 },
            { id: 40, type: 'mcq', q: "Convert to radical form: x^(3/4)", options: ["‚Å¥‚àöx¬≥", "¬≥‚àöx‚Å¥", "‚àö(x^0.75)", "1/x^0.75"], correct: 0 },
            { id: 41, type: 'mcq', q: "Which inequality represents 'all numbers less than 2 or greater than 6'?", options: ["|x - 4| < 2", "|x - 4| > 2", "|x + 4| < 2", "|x + 4| > 2"], correct: 1 },
            { id: 42, type: 'mcq', q: "Simplify: ‚Å¥‚àöx‚Å∏", options: ["x¬≤", "x‚Å¥", "x¬π¬≤", "x"], correct: 0 },
            { id: 43, type: 'mcq', q: "What is the value of the discriminant for f(x) = x¬≤ + 2x + 5?", options: ["24", "16", "-16", "0"], correct: 2 },
            { id: 44, type: 'mcq', q: "Which factor is common to x¬≤ - 9 and x¬≤ - 5x + 6?", options: ["(x + 3)", "(x - 3)", "(x - 2)", "(x + 2)"], correct: 1 },
            { id: 45, type: 'mcq', q: "Solve: 2^x = 16", options: ["2", "3", "4", "8"], correct: 2 },
            { id: 46, type: 'mcq', q: "What is the simplified form of ‚àö(72x¬≥)?", options: ["6x‚àö2x", "12x‚àö2", "2x‚àö6", "36x‚àö2x"], correct: 0 },
            { id: 47, type: 'mcq', q: "Solve for x: (x + 3)^(1/2) = 4", options: ["1", "5", "13", "19"], correct: 2 },
            { id: 48, type: 'mcq', q: "What is the leading coefficient of f(x) = -3x‚Å¥ + 2x¬≤ - 5?", options: ["4", "-3", "2", "-5"], correct: 1 },
            { id: 49, type: 'mcq', q: "Identify the inverse of y = 2x + 4", options: ["y = x/2 - 2", "y = 2x - 4", "y = x - 2", "y = (x-4)/2"], correct: 3 },
            { id: 50, type: 'mcq', q: "If f(x) = x¬≤ and g(x) = x - 5, what is f(g(x))?", options: ["x¬≤ - 5", "x¬≤ - 25", "(x - 5)¬≤", "x¬≤ - 10x + 25"], correct: 2 },
            { id: 51, type: 'mcq', q: "Simplify the rational expression: (x¬≤ - 1) / (x - 1)", options: ["x", "x - 1", "x + 1", "1"], correct: 2 },
            { id: 52, type: 'mcq', q: "Multiply: (x + 2i)(x - 2i)", options: ["x¬≤ - 4", "x¬≤ + 4", "x¬≤ - 4i", "x¬≤ + 4i"], correct: 1 },
            { id: 53, type: 'mcq', q: "Simplify: ‚àö( -25 )", options: ["-5", "5", "-5i", "5i"], correct: 3 },
            { id: 54, type: 'mcq', q: "Factor completely: 2x¬≤ - 8", options: ["(2x - 4)(x + 2)", "2(x - 2)(x + 2)", "2(x¬≤ - 4)", "(x - 2)(2x + 4)"], correct: 1 },
            { id: 55, type: 'mcq', q: "Given f(x) = 3x¬≤ - 4, find f(-2).", options: ["8", "-16", "16", "-8"], correct: 0 },
            { id: 56, type: 'mcq', q: "Solve: x¬≤ - 6x + 9 = 0", options: ["x = 3", "x = -3", "x = ¬±3", "No solution"], correct: 0 },
            { id: 57, type: 'mcq', q: "Factor the denominator to simplify: (x - 4) / (x¬≤ - 16)", options: ["x + 4", "1 / (x + 4)", "1 / (x - 4)", "x - 4"], correct: 1 },
            { id: 58, type: 'mcq', q: "Solve x¬≤ = 100", options: ["10", "-10", "¬±10", "¬±50"], correct: 2 },
            { id: 59, type: 'mcq', q: "Simplify i‚Å¥", options: ["i", "-i", "1", "-1"], correct: 2 },
            { id: 60, type: 'mcq', q: "Which set contains ONLY integers?", options: ["{0.5, 1, 2}", "{‚àö2, ‚àö3, ‚àö4}", "{-1, 0, 1}", "{1/2, 1/3, 1/4}"], correct: 2 }
        ];

        let state = { answers: {}, timeRemaining: 3600, isPaused: false, examStarted: false, examSubmitted: false, isReviewing: false };
        let timerInterval;

        let isDrawing = false;
        let brushColor = '#2563eb';
        let brushSize = 2;
        const canvas = document.getElementById('scratch-pad');
        const ctx = canvas.getContext('2d');

        function startExam() {
            state.examStarted = true;
            document.body.classList.remove('exam-locked');
            document.getElementById('exam-gatekeeper').classList.add('hidden');
            document.getElementById('pause-btn').classList.remove('hidden');
            initDrawing();
            startTimer();
            render();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (!state.isPaused && !state.examSubmitted) {
                    state.timeRemaining--;
                    updateTimerDisplay();
                    if(state.timeRemaining <= 0) processSubmit();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(state.timeRemaining / 60);
            const s = state.timeRemaining % 60;
            document.getElementById('timer-display').innerText = `${m}:${s.toString().padStart(2, '0')}`;
        }

        function togglePause() {
            state.isPaused = !state.isPaused;
            document.getElementById('pause-overlay')?.remove();
            if (state.isPaused) {
                const overlay = document.createElement('div');
                overlay.id = "pause-overlay";
                overlay.className = "fixed inset-0 bg-slate-900/60 z-[300] flex items-center justify-center p-6";
                overlay.innerHTML = `<div class="bg-white p-8 rounded-2xl max-w-sm shadow-2xl border-4 border-amber-400 text-center">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">Exam Paused</h2>
                    <button onclick="togglePause()" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded-lg shadow-lg">‚ñ∂Ô∏è Resume Exam</button>
                </div>`;
                document.body.appendChild(overlay);
                document.body.classList.add('exam-locked');
            } else {
                document.body.classList.remove('exam-locked');
            }
        }

        function confirmSubmit() {
            const answered = Object.keys(state.answers).length;
            const modal = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            content.innerHTML = `
                <h3 class="text-2xl font-bold mb-4 text-slate-800">Finish Exam?</h3>
                <p class="mb-6 text-slate-600">You've answered <b>${answered}</b> out of 60 questions.</p>
                <div class="flex gap-4">
                    <button onclick="hideModal()" class="flex-1 py-3 border rounded-xl hover:bg-slate-50 font-bold">Back</button>
                    <button onclick="processSubmit()" class="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700">Submit Now</button>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        function hideModal() { document.getElementById('modal-overlay').classList.add('hidden'); }

        function processSubmit() {
            state.examSubmitted = true;
            clearInterval(timerInterval);
            hideModal();
            document.body.classList.add('exam-submitted');
            
            let score = 0;
            questions.forEach(q => {
                const ans = state.answers[q.id];
                if(ans === q.correct) score++;
            });

            const percent = Math.round((score / 60) * 100);
            const overlay = document.getElementById('results-overlay');
            const resultsContent = document.getElementById('results-content');
            overlay.classList.remove('hidden');
            
            resultsContent.innerHTML = `
                <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-12 border-t-8 border-blue-600 max-w-2xl mx-auto">
                    <h2 class="text-3xl font-black text-slate-800 mb-6">Results</h2>
                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="bg-blue-50 p-6 rounded-2xl text-center border border-blue-100">
                            <p class="text-xs font-bold text-blue-400 uppercase tracking-widest mb-1">Final Score</p>
                            <p class="text-4xl font-black text-blue-700">${score}<span class="text-blue-300 text-lg">/60</span></p>
                        </div>
                        <div class="bg-slate-50 p-6 rounded-2xl text-center border">
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Grade</p>
                            <p class="text-4xl font-black text-slate-700">${percent}%</p>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3">
                        <button onclick="reviewAnswers()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95">
                            Review Answers
                        </button>
                        <button onclick="window.location.reload()" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-800 font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95">
                            Retake Practice Test
                        </button>
                    </div>
                </div>
            `;
        }

        function reviewAnswers() {
            state.isReviewing = true;
            document.getElementById('results-overlay').classList.add('hidden');
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveAnswer(id, val) {
            if(state.examSubmitted) return;
            state.answers[id] = val;
            document.getElementById('progress-text').innerText = `${Object.keys(state.answers).length}/60`;
            render();
        }

        function render() {
            const container = document.getElementById('test-container');
            container.innerHTML = questions.map(q => {
                const userAns = state.answers[q.id];
                const isCorrect = userAns === q.correct;

                let html = `<div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 relative z-10 ${state.isReviewing ? (isCorrect ? 'ring-2 ring-emerald-500' : 'ring-2 ring-red-500') : ''}">
                    <div class="flex items-start justify-between gap-4 mb-6">
                        <div class="flex items-start gap-4">
                            <span class="bg-slate-800 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-xs">${q.id}</span>
                            <p class="text-lg font-semibold text-slate-800 pt-1">${q.q}</p>
                        </div>
                        ${state.isReviewing ? (isCorrect ? '<span class="text-emerald-600 font-bold">‚úì Correct</span>' : '<span class="text-red-600 font-bold">‚úó Incorrect</span>') : ''}
                    </div>`;

                if (q.type === 'mcq') {
                    html += `<div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:pl-12">
                        ${q.options.map((opt, i) => {
                            let statusClass = '';
                            if (state.isReviewing) {
                                if (i === q.correct) statusClass = 'correct-choice';
                                else if (userAns === i && i !== q.correct) statusClass = 'incorrect-choice';
                            } else if (userAns === i) {
                                statusClass = 'border-blue-600 bg-blue-50 ring-2 ring-blue-100';
                            }

                            return `
                                <button onclick="saveAnswer(${q.id}, ${i})" class="text-left p-4 border-2 rounded-xl transition-all ${statusClass || 'border-slate-100'}" ${state.isReviewing ? 'disabled' : ''}>
                                    <span class="font-bold text-slate-400 mr-2">${['A','B','C','D'][i]}.</span> ${opt}
                                </button>
                            `;
                        }).join('')}
                    </div>`;
                } else if (q.type === 'graph-mcq') {
                    html += `<div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:pl-12">
                        ${q.graphs.map((g, i) => {
                            let statusClass = '';
                            if (state.isReviewing) {
                                if (i === q.correct) statusClass = 'correct-choice';
                                else if (userAns === i && i !== q.correct) statusClass = 'incorrect-choice';
                            } else if (userAns === i) {
                                statusClass = 'selected';
                            }

                            return `
                                <div onclick="${state.isReviewing ? '' : `saveAnswer(${q.id}, ${i})`}" class="graph-option-card border-2 rounded-xl p-2 ${statusClass || 'border-slate-100'}">
                                    <div class="w-full aspect-square mb-2">${generateGraphSVG(g.type, g.params)}</div>
                                    <div class="text-center font-bold text-slate-500">${['A','B','C','D'][i]}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>`;
                }
                html += `</div>`;
                return html;
            }).join('');
        }

        function initDrawing() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            window.addEventListener('resize', () => {
                const temp = ctx.getImageData(0,0,canvas.width,canvas.height);
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                ctx.putImageData(temp, 0, 0);
            });
            canvas.addEventListener('mousedown', startPosition);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', endPosition);
        }

        function startPosition(e) {
            if(!document.body.classList.contains('drawing-active')) return;
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(e.clientX, e.clientY);
        }

        function draw(e) {
            if(!isDrawing) return;
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.strokeStyle = brushColor;
            ctx.lineTo(e.clientX, e.clientY);
            ctx.stroke();
        }

        function endPosition() { isDrawing = false; }

        function setTool(tool) {
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${tool}`).classList.add('active');
            if(tool === 'cursor') {
                document.body.classList.remove('drawing-active');
            } else {
                document.body.classList.add('drawing-active');
                brushSize = (tool === 'marker') ? 8 : 2;
            }
        }

        function setColor(color) {
            brushColor = color;
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            const map = {'#2563eb': 'blue', '#ef4444': 'red', '#000000': 'black'};
            document.getElementById(`color-${map[color]}`).classList.add('active');
        }

        function clearScratchpad() { ctx.clearRect(0,0,canvas.width,canvas.height); }

        window.onload = render;
    </script>
</body>
</html>
